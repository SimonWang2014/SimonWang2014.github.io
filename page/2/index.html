<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Bilberry Blog, hexo blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Hello">
<meta property="og:url" content="http://xydida.com/page/2/index.html">
<meta property="og:site_name" content="Hello">
<meta property="og:description" content="Bilberry Blog, hexo blog">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello">
<meta name="twitter:description" content="Bilberry Blog, hexo blog">
  
    <link rel="alternate" href="/atom.xml" title="Hello" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">能找到我的也不是等闲之辈</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xydida.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-The-Perfect-URL-Regular-Expression" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/8/11/Regular-Expression/The-Perfect-URL-Regular-Expression/" class="article-date">
  <time datetime="2018-08-11T04:33:30.000Z" itemprop="datePublished">2018-08-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Regular-Expression/">Regular Expression</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/8/11/Regular-Expression/The-Perfect-URL-Regular-Expression/">部分语言URL正则匹配</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>开发中，经常会需要做一些正则匹配，比如手机号验证，email验证，URL匹配等，写此篇文章主要是记录如何使用正则表达式匹配URL，方便以后再遇到此问题时不必到处搜索而得不到满意的答案。</p>
<h2 id="PHP（使用preg-match"><a href="#PHP（使用preg-match" class="headerlink" title="PHP（使用preg_match)"></a>PHP（使用<a href="http://php.net/manual/en/function.preg-match.php" target="_blank" rel="noopener">preg_match</a>)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%^(?:(?:https?|ftp)://)(?:\S+(?::\S*)?@|\d&#123;1,3&#125;(?:\.\d&#123;1,3&#125;)&#123;3&#125;|(?:(?:[a-z\d\x&#123;00a1&#125;-\x&#123;ffff&#125;]+-?)*[a-z\d\x&#123;00a1&#125;-\x&#123;ffff&#125;]+)(?:\.(?:[a-z\d\x&#123;00a1&#125;-\x&#123;ffff&#125;]+-?)*[a-z\d\x&#123;00a1&#125;-\x&#123;ffff&#125;]+)*(?:\.[a-z\x&#123;00a1&#125;-\x&#123;ffff&#125;]&#123;2,6&#125;))(?::\d+)?(?:[^\s]*)?$%iu</span><br></pre></td></tr></table></figure>
<h2 id="PHP（使用validate-filter"><a href="#PHP（使用validate-filter" class="headerlink" title="PHP（使用validate filter)"></a>PHP（使用<a href="http://php.net/manual/en/filter.filters.validate.php" target="_blank" rel="noopener">validate filter</a>)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (filter_var($url, FILTER_VALIDATE_URL) !== false)...</span><br></pre></td></tr></table></figure>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+</span><br></pre></td></tr></table></figure>
<h2 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/((([A-Za-z]&#123;3,9&#125;:(?:\/\/)?)(?:[\-;:&amp;=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&amp;=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&amp;;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/</span><br></pre></td></tr></table></figure>
<h2 id="HTML5"><a href="#HTML5" class="headerlink" title="HTML5"></a>HTML5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;url&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>匹配上面<code>input</code>输入的URL（<a href="https://www.ietf.org/rfc/rfc3986.txt" target="_blank" rel="noopener">RFC3986</a>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?</span><br></pre></td></tr></table></figure>
<h2 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(((ht|f)tp(s?))\://)?(www.|[a-zA-Z].)[a-zA-Z0-9\-\.]+\.(com|edu|gov|mil|net|org|biz|info|name|museum|us|ca|uk)(\:[0-9]+)*(/($|[a-zA-Z0-9\.\,\;\?\&apos;\\\+&amp;%\$#\=~_\-]+))*$</span><br></pre></td></tr></table></figure>
<h2 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/\A(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d&#123;1,3&#125;)&#123;3&#125;)(?!127(?:\.\d&#123;1,3&#125;)&#123;3&#125;)(?!169\.254(?:\.\d&#123;1,3&#125;)&#123;2&#125;)(?!192\.168(?:\.\d&#123;1,3&#125;)&#123;2&#125;)(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d&#123;1,3&#125;)&#123;2&#125;)(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d&#123;1,2&#125;|2[0-4]\d|25[0-5]))&#123;2&#125;(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]&#123;2,&#125;)))(?::\d&#123;2,5&#125;)?(?:\/[^\s]*)?\z/i</span><br></pre></td></tr></table></figure>
<h2 id="Go-使用govalidator-IsURL"><a href="#Go-使用govalidator-IsURL" class="headerlink" title="Go (使用govalidator.IsURL)"></a>Go (使用govalidator.IsURL)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"> import (</span><br><span class="line">         &quot;fmt&quot;</span><br><span class="line">         &quot;github.com/asaskevich/govalidator&quot;</span><br><span class="line"> )</span><br><span class="line"> func main() &#123;</span><br><span class="line">         str := &quot;http://www.urlregex.com&quot;</span><br><span class="line">         validURL := govalidator.IsURL(str)</span><br><span class="line">         fmt.Printf(&quot;%s is a valid URL : %v \n&quot;, str, validURL)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Objective-C"><a href="#Objective-C" class="headerlink" title="Objective-C"></a>Objective-C</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(http|https)://((\\w)*|([0-9]*)|([-|_])*)+([\\.|/]((\\w)*|([0-9]*)|([-|_])*))+</span><br></pre></td></tr></table></figure>
<h2 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((?:http|https)://)?(?:www\\.)?[\\w\\d\\-_]+\\.\\w&#123;2,3&#125;(\\.\\w&#123;2&#125;)?(/(?&lt;=/)(?:[\\w\\d\\-./_]+)?)?</span><br></pre></td></tr></table></figure>
<p>定义一个函数方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func canOpenURL(string: String?) -&gt; Bool &#123;</span><br><span class="line">    let regEx = &quot;((https|http)://)((\\w|-)+)(([.]|[/])((\\w|-)+))+&quot;</span><br><span class="line">    let predicate = NSPredicate(format:&quot;SELF MATCHES %@&quot;, argumentArray:[regEx])</span><br><span class="line">    return predicate.evaluateWithObject(string)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if canOpenURL(&quot;http://www.urlregex.com&quot;) &#123;</span><br><span class="line">    print(&quot;valid url.&quot;)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    print(&quot;invalid url.&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Swift-使用官方提供的canOpenURL"><a href="#Swift-使用官方提供的canOpenURL" class="headerlink" title="Swift (使用官方提供的canOpenURL)"></a>Swift (使用官方提供的<a href="https://developer.apple.com/documentation/uikit/uiapplication/1622952-canopenurl" target="_blank" rel="noopener">canOpenURL</a>)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIApplication.sharedApplication().canOpenURL(urlString)</span><br></pre></td></tr></table></figure>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(https?|ftp|file)://[-a-zA-Z0-9+&amp;@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&amp;@#/%=~_|]</span><br></pre></td></tr></table></figure>
<h2 id="VB-NET"><a href="#VB-NET" class="headerlink" title="VB.NET"></a>VB.NET</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(http(s)?://)?([\w-]+\.)+[\w-]+[.com]+(/[/?%&amp;=]*)?</span><br></pre></td></tr></table></figure>
<h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\&apos;\/\\\+&amp;%\$#_]*)?$</span><br></pre></td></tr></table></figure>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT field FROM table </span><br><span class="line">WHERE field </span><br><span class="line">REGEXP &quot;^(https?://|www\\.)[\.A-Za-z0-9\-]+\\.[a-zA-Z]&#123;2,4&#125;</span><br></pre></td></tr></table></figure>
<p>整理自：<a href="http://urlregex.com" target="_blank" rel="noopener">http://urlregex.com</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xydida.com/2018/8/11/Regular-Expression/The-Perfect-URL-Regular-Expression/" data-id="cjpwpr31000065m9kwrxqqmxi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/">Go</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Objective-C/">Objective-C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Perl/">Perl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/">Swift</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VB-NET/">VB.NET</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-why-htmlspecialchars-returns-null-in-PHP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/6/18/PHP/why-htmlspecialchars-returns-null-in-PHP/" class="article-date">
  <time datetime="2018-06-18T15:08:01.000Z" itemprop="datePublished">2018-06-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/6/18/PHP/why-htmlspecialchars-returns-null-in-PHP/">解决PHP中htmlspecialchars返回null的问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在开发中，经常需要对用户传过来的数据进行过滤，来阻止一些用户的恶意输入，在PHP中常用到<code>htmlspecialchars()</code>、<code>htmlentities()</code>和<code>strip_tags()</code>函数来处理。</p>
<p>今天在使用<code>htmlspecialchars()</code>做特殊字符的转换时，一直返回<code>null</code>，当我换成<code>htmlentities()</code>也是同样的问题，查官方手册才发现原来是编码的问题。</p>
<p>函数声明：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fsg8j0lpb8j30oj01r3yx.jpg" alt=""></p>
<p>问题主要处在第三个参数上，对于第三个参数官方是这么说的：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fsg8jbqp36j30sq05tmyn.jpg" alt=""></p>
<p>这个参数的作用是设置转换字符时采用的编码，在PHP 5.4 和5.5中使用了<strong>UTF-8</strong>作为默认编码，而在PHP 5.4之前使用<strong>ISO-8859-1</strong>作为默认编码，从PHP 5.6开始就使用PHP配置文件中的<code>default_charset</code>参数作为默认编码。<code>encoding</code>参数支持的字符集：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fsg8jl4onxj30r80ir0xa.jpg" alt=""></p>
<p>从PHP的更新日志也能看到这个参数的变化：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fsg8js1l1aj30sk05jab6.jpg" alt=""></p>
<p>一般我们是这么使用的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$str=&apos;&lt;a href=&quot;test.html&quot;&gt;\&apos;测试页面\&apos;&lt;/a&gt;&lt;script&gt;alert(213)&lt;/script&gt;&apos;;</span><br><span class="line">echo htmlspecialchars($str);</span><br><span class="line">// 输出：&amp;lt;a href=&amp;quot;test.html&amp;quot;&amp;gt;&apos;测试页面&apos;&amp;lt;/a&amp;gt;&amp;lt;script&amp;gt;alert(213)&amp;lt;/script&amp;gt;</span><br></pre></td></tr></table></figure>
<p>今天在使用的时候，结果一直返回null，其实就是编码的问题，这个时候就需要用到第三个参数了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo htmlspecialchars($string, ENT_COMPAT,&apos;ISO-8859-1&apos;, true);</span><br></pre></td></tr></table></figure>
<p>同样，也适用于<code>htmlentities</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo htmlentities($string, ENT_COMPAT,&apos;ISO-8859-1&apos;, true);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xydida.com/2018/6/18/PHP/why-htmlspecialchars-returns-null-in-PHP/" data-id="cjpwpr31l000y5m9k40zfubmk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Learn-MySQL-indexes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/6/6/MySQL/Learn-MySQL-indexes/" class="article-date">
  <time datetime="2018-06-06T11:10:04.000Z" itemprop="datePublished">2018-06-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/6/6/MySQL/Learn-MySQL-indexes/">MySQL中的索引学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fs2f97s3m4j31kw16o1kz.jpg" alt=""></p>
<h1 id="什么是索引？"><a href="#什么是索引？" class="headerlink" title="什么是索引？"></a>什么是索引？</h1><p>在没有学数据库之前，大多数人对索引还是比较陌生（可能学完之后还是比较陌生：），今天我想告诉大家索引很有用，而且面试的时候都会问到。那么索引是什么呢？</p>
<p>其实索引这个东西我们很早就接触过了，想象一下当初学习《现代汉语词典》的时候，老师是如何教我们使用的，就可以理解什么是索引了。《现代汉语词典》有将近1800页，里面的汉字大概有1.3万多个，我们是如何在这么多的汉字中找到某个字呢？老师大概是这么教我们的：词典提供了“音节表”，“音节表”将所有汉子的汉语拼音编入其中，并且“音节表”按’a’到’z’的顺序排序，故而我们可以轻松的在音节表中找到某个字所对应的页数。其实不光是词典，我们看的书大部分都有目录，而这个目录就相当于索引的作用，如下是三本书的目录：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fs1onskl51j31kw23vx6p.jpg" alt="《禅与摩托车维修艺术》的目录"></p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fs1opioucuj31kw23vu0y.jpg" alt="《黑客与画家》的目录"></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fs1oq9j6zuj31kw23vx6q.jpg" alt="《计算机程序的构造和解释》的目录"></p>
<p>通过上面三本书的目录的对比，很明显第一本书的目录写的很简单，第二本书稍详细一点，而第三本书的目录最详细，目录写得越详细，读者在阅读的时候就越方便。</p>
<p>不管是词典中的音节表还是书的目录，它们实际都是索引的一种存在形式，都是为了能够提高查找的效率。</p>
<h2 id="数据库中索引的本质"><a href="#数据库中索引的本质" class="headerlink" title="数据库中索引的本质"></a>数据库中索引的本质</h2><p>本质上，索引其实是数据库表中字段值的复制，该字段称为索引的关键字。</p>
<h2 id="索引在计算机中的存储"><a href="#索引在计算机中的存储" class="headerlink" title="索引在计算机中的存储"></a>索引在计算机中的存储</h2><p>在学习数据结构时，曾讲到文件的概念，而数据库中所有的数据都是以文件的形式保存的计算机中的，所以文件系统是数据库系统的基础。而数据库在操作这些文件时，都是先将文件中的数据加载到内存，然后再以某种数据结构来操作这些数据，通常的数据结构可以是<a href="http://lib.csdn.net/article/datastructure/9204" target="_blank" rel="noopener">AVL树</a>、<a href="https://blog.csdn.net/v_july_v/article/details/6530142" target="_blank" rel="noopener">B树</a>、<a href="https://blog.csdn.net/v_july_v/article/details/6530142" target="_blank" rel="noopener">B+树</a>等。数据库中的往往是要存大量的数据的，而所有的数据不可能一次性全部加载到内存中，这时候就需要索引与分块加载来提高查询的速度，不过一般初学者不会体验到索引带来的高效，因为他们的电脑内存足够大完全可以一次性加载完所有数据，这也导致初学者忽略了对索引的仔细学习。如下是MyISAM存储引擎的索引示意图：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fs1qj978vfj30qe0cigms.jpg" alt="MyISAM存储引擎teacher表的主索引及普通索引"></p>
<p>更多关于数据库索引背后的数据结构和算法原理，请查看：<a href="https://www.cnblogs.com/tgycoder/p/5410057.html" target="_blank" rel="noopener">https://www.cnblogs.com/tgycoder/p/5410057.html</a></p>
<h1 id="MySQL中的索引"><a href="#MySQL中的索引" class="headerlink" title="MySQL中的索引"></a>MySQL中的索引</h1><p>在MySQL中，共有4类索引：主键索引、唯一索引、常规索引和全文索引。</p>
<h2 id="主键索引-Primary-key"><a href="#主键索引-Primary-key" class="headerlink" title="主键索引(Primary key)"></a>主键索引(Primary key)</h2><p>主键索引是关系数据库中最常见的索引类型。它根据主键自身的唯一性来唯一标识每条记录。因此该键必须是表中的唯一值。创建主键索引很简单，如下：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fs1r9yjm69j30mi06kgnw.jpg" alt=""></p>
<p>每个表只能有一个自增字段，该字段必须指定为主键。此外，任何指定为主键的字段不能是NULL，即使没有声明为NOT NULL，MySQL会自己设置。</p>
<h2 id="唯一索引-Unique"><a href="#唯一索引-Unique" class="headerlink" title="唯一索引(Unique)"></a>唯一索引(Unique)</h2><p>与主键索引一样，唯一索引可以防止创建重复的值。不同之处在于每个表只能有一个主键索引，但可以有多个唯一索引。修改上面的sql语句来增加唯一索引：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fs1sopkc84j30la068ac3.jpg" alt=""></p>
<p>如前面所讲，表中可以指定多个唯一字段，我们现在将<code>name</code>字段也设置为唯一：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fs1sqt9824j30l206iwgr.jpg" alt=""></p>
<p>还可以指定多列唯一索引，比如上面的表结构中，允许用户插入重复的url，甚至可以插入重复的name值，但不希望出现重复的name和url的组合。可以创建多列唯一索引来强制这种约束，如下：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fs1suh963uj30m207oacm.jpg" alt=""></p>
<h2 id="常规索引-Index"><a href="#常规索引-Index" class="headerlink" title="常规索引(Index)"></a>常规索引(Index)</h2><p>可能经常需要对数据库的搜索效率进行优化，以便能够根据并非主键甚至并非唯一的列获取数据行。为此，最有效的方法是采用某种方式索引列，是的数据库尽可能快的查找想要的值。这就称为常规索引。</p>
<h3 id="单列常规索引"><a href="#单列常规索引" class="headerlink" title="单列常规索引"></a>单列常规索引</h3><p>如果表中的某个列经常需要被查询到，就应该使用单列常规索引。假如，一张员工表you 4列：主键id，名字，姓氏和电子邮箱，若果大多数的查询操作都会针对员工的姓氏或者电子邮箱，因为员工的姓氏可以有重复的，而电子邮箱必须唯一，我们就可以给姓氏创建一个常规索引，电子邮箱创建一个唯一索引，如下：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fs2e082sw6j30lu07edif.jpg" alt=""></p>
<p>同时，MySQL还提供了创建局部字段索引的特性，方式是：将某一字段的前N的字符作为索引，相比于单列常规索引，局部索引需要更少的磁盘空间，同时由于索引的数据短，因此效率会高一点。修改前面的示例，因为通常lastname的前5个字符就足以确保获取到唯一的数据，修改如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fs2e0s2v9ij30lu07edif.jpg" alt=""></p>
<h3 id="多列常规索引"><a href="#多列常规索引" class="headerlink" title="多列常规索引"></a>多列常规索引</h3><p>一般查询时，通常需要包含多列，我们可以指定一些经常被查询的列为多列常规索引。MySQL的多列常规索引方法基于一种<a href="https://www.zhihu.com/question/36996520" target="_blank" rel="noopener">最左前缀(leftmost prefixing)</a>的策略。最左前缀指出包含列A、B和C的任何多列索引都可以提高涉及如下列组合的查询的性能：</p>
<ul>
<li>A、B、C</li>
<li>A、B</li>
<li>A</li>
</ul>
<p>创建多列索引：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fs2e0z82f0j30km07cmzr.jpg" alt=""></p>
<p>上图中创建了三个索引，第一个是主键索引，第二个是电子邮箱的唯一索引，第三个就是多列索引，包括两列：lastname和firstname。</p>
<h3 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h3><p>当字段类型为char、varchar或text时，我们可以使用全文索引。在MySQL中，对大量自然语言做全文搜索时，它提供了一种数据获取的机制，并生成最符合用户需要的结果。比如在对这样“Nginx is the world’s most popular web server”的字符串进行搜索时，单词is和the对结果几乎起不了任何作用，MySQL在搜索时，将文本分解为单词，默认忽略少于4个字符的单词。创建全文索引：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fs2e17ph34j30ku07ajtu.jpg" alt=""></p>
<p>创建全文索引的方式与创建其他索引没什么区别，但基于全文索引的查询却有一点不同。在查询时，select语句需要使用两个特殊的MySQL函数<code>match()</code>和<code>againet()</code>。查询方式如下：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fs2e1enqvrj314c010mxp.jpg" alt=""></p>
<h4 id="Boolean全文搜索"><a href="#Boolean全文搜索" class="headerlink" title="Boolean全文搜索"></a>Boolean全文搜索</h4><p>Boolean全文搜索对查询提供了更加细的控制允许显示地标识候选结果中应当或不应当出现哪些词（MySQL默认会忽略少于4个字符的关键词）。以下是关于Boolean操作符的描述：</p>
<p>+ 前导加号确保后面的单词出现在每个结果记录中<br>- 前导减号确保后面的单词不出现在任何结果记录中<br>* 结尾处的星号允许接受关键字变体，只要该变体以星号前面的单词所制定的字符串开头<br>“ “ 外围的双引号确保结果记录包含所包围的字符串，要严格按照输入时的形式出现<br>&lt; &gt; 前导的大于号和小于号分别用于增加和减少后面单词的搜索级别相关度<br>( ) 小括号用于将单词分组为子表达式</p>
<p>如下是几个简单的例子：</p>
<ol>
<li>返回包含Nginx，但不包含manual的记录：</li>
</ol>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fs2e7333k8j30tw01yt98.jpg" alt=""></p>
<ol start="2">
<li>返回包含单词Nginx，但不包含Apache或Tomcat的记录：</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fs2e9gd0sqj30t201wwf2.jpg" alt=""></p>
<ol start="3">
<li>返回包含web和scripting或者php和scripting的记录，但web scripting的搜索级别低于php scripting：</li>
</ol>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fs2ecup96cj30t00220t8.jpg" alt=""></p>
<p>注意，由于MySQL默认会忽略少于4个字符的单词，所以执行上面的SQL命令时，应该先修改<code>ft_min_word_len</code>参数。</p>
<h1 id="索引选取的注意事项"><a href="#索引选取的注意事项" class="headerlink" title="索引选取的注意事项"></a>索引选取的注意事项</h1><ol>
<li>只对<code>WHERE</code>和<code>ORDER BY</code>子句中需要的列添加索引，过多的索引会占用很多硬盘空间，在修改数据时还会降低性能，因为每次修改数据时都需要更新索引。</li>
<li>如果创建如<code>INDEX(firstname, lastname)</code>的索引时，不要再创建<code>INDEX(firstname)</code>，因为MySQL的索引采用最左前缀策略。</li>
<li>需要索引的列要不为空（NOT NULL），保证构建索引时不存储NULL值。</li>
<li>可以开启慢查询日志，通过对慢查询日志的分析来优化索引。</li>
</ol>
<p>参考：<br>《PHP与MySQL程序设计（第四版）》</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xydida.com/2018/6/6/MySQL/Learn-MySQL-indexes/" data-id="cjpwpr32c002k5m9kf2p2meup" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-The-secret-you-do-not-know-the-static-in-PHP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/6/5/PHP/The-secret-you-do-not-know-the-static-in-PHP/" class="article-date">
  <time datetime="2018-06-05T09:29:04.000Z" itemprop="datePublished">2018-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/6/5/PHP/The-secret-you-do-not-know-the-static-in-PHP/">PHP中的static关键字</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://upload-images.jianshu.io/upload_images/2650331-3496c25ffeaf7073.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>PHP和Java中都会有<code>static</code>这个关键字，用法也类似，当问及PHP中的<code>static</code>用法是，很容易想出<code>static</code>可以声明类属性或方法为静态，静态属性和方法都是属于类的，静态属性不能通过对象访问，但静态方法可以通过对象访问。没错，是这样的，但是在PHP中<code>static</code>还有另外的用处哦。</p>
<h2 id="先从static变量的作用域开始"><a href="#先从static变量的作用域开始" class="headerlink" title="先从static变量的作用域开始"></a>先从static变量的作用域开始</h2><p>PHP中<code>static</code>变量只存在于本地函数中，但是当程序执行完本函数后，<code>static</code>变量还会一直存在，考虑如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function test()</span><br><span class="line">&#123;</span><br><span class="line">    $a = 0;</span><br><span class="line">    echo $a . &quot;\n&quot;;</span><br><span class="line">    $a++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 都会输出0</span><br><span class="line">for ($i=0; $i&lt;5; $i++) &#123;</span><br><span class="line">    test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在每次调用这个函数的时候，函数都会将<code>$a</code>变量置0，再输出，尽管每次输出后，变量<code>$a</code>都加1了，为了每次都能将<code>$a</code>的值保存起来，我们可以将它声明为<code>static</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function test()</span><br><span class="line">&#123;</span><br><span class="line">    static $a = 0;</span><br><span class="line">    echo $a . &quot;\n&quot;;</span><br><span class="line">    $a++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 输出</span><br><span class="line">// 0</span><br><span class="line">// 1</span><br><span class="line">// 2</span><br><span class="line">// 3</span><br><span class="line">// 4</span><br><span class="line">for ($i=0; $i&lt;5; $i++) &#123;</span><br><span class="line">    test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，<code>$a</code>只被初始化了一次，每次调用<code>test()</code>函数时，<code>$a</code>都会加1。</p>
<p>在递归函数中，同样可以使用静态变量，我们可以设置一个<code>$count</code>静态变量的函数运行计数器，保存运行的次数，当<code>$count</code>到10时，就退出递归函数，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function test()</span><br><span class="line">&#123;</span><br><span class="line">    static $count = 0;</span><br><span class="line"></span><br><span class="line">    $count++;</span><br><span class="line">    echo $count;</span><br><span class="line">    if ($count &lt; 10) &#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<p>静态变量初始化时只能是确定的一个值，不能是函数的返回值，下面的代码中，将<code>sqrt()</code>函数的结果赋值给静态变量<code>$a</code>会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function foo()&#123;</span><br><span class="line">    static $a = 0;          // correct</span><br><span class="line">    static $a = 1+2;        // correct (as of PHP 5.6)</span><br><span class="line">    static $a = sqrt(121);  // wrong  (as it is a function)</span><br><span class="line"></span><br><span class="line">    echo $a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<p>程序没有运行前，再phpstorm中就已经其实不能用表达式初始化静态变量：</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/assign%20expression%20to%20static.png" alt=""></p>
<p>程序运行时也会报如下错误：</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/run%20assign%20expression%20to%20static.png" alt=""></p>
<h2 id="声明类属性或方法为静态"><a href="#声明类属性或方法为静态" class="headerlink" title="声明类属性或方法为静态"></a>声明类属性或方法为静态</h2><p>声明类属性或方法为静态，就可以不实例化类而直接访问。静态属性不能通过一个类已实例化的对象来访问（但静态方法可以）。为了兼容 PHP 4，如果没有指定访问控制，属性和方法默认为公有。由于静态方法不需要通过对象即可调用，所以伪变量 $this 在静态方法中不可用。静态属性不可以由对象通过 -&gt; 操作符来访问。用静态方式调用一个非静态方法会导致一个 E_STRICT 级别的错误。就像其它所有的 PHP 静态变量一样，静态属性只能被初始化为文字或常量，不能使用表达式。所以可以把静态属性初始化为整数或数组，但不能初始化为另一个变量或函数返回值，也不能指向一个对象。自 PHP 5.3.0 起，可以用一个变量来动态调用类。但该变量的值不能为关键字 self，parent 或 static。如下是静态属性的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Foo</span><br><span class="line">&#123;</span><br><span class="line">    public static $my_static = &apos;foo&apos;;</span><br><span class="line"></span><br><span class="line">    public function staticValue() &#123;</span><br><span class="line">        return self::$my_static;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Bar extends Foo</span><br><span class="line">&#123;</span><br><span class="line">    public function fooStatic() &#123;</span><br><span class="line">        return parent::$my_static;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print Foo::$my_static . &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">$foo = new Foo();</span><br><span class="line">print $foo-&gt;staticValue() . &quot;\n&quot;;</span><br><span class="line">print $foo-&gt;my_static . &quot;\n&quot;;      // 对象不能使用-&gt;符号调用静态变量</span><br><span class="line"></span><br><span class="line">print $foo::$my_static . &quot;\n&quot;;</span><br><span class="line">$classname = &apos;Foo&apos;;</span><br><span class="line">print $classname::$my_static . &quot;\n&quot;; // 5.3开始可以使用变量调用类</span><br><span class="line"></span><br><span class="line">print Bar::$my_static . &quot;\n&quot;;</span><br><span class="line">$bar = new Bar();</span><br><span class="line">print $bar-&gt;fooStatic() . &quot;\n&quot;;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/examples%20of%20static%20attrs.png" alt=""></p>
<p>作为静态变量，还可以在多个对象之间共享数据，创建好几个对象的时候，因为每次都是new的，所以创建的对象都不同，如果想让多个对象实例共享同一个变量，就可以用到静态变量。假设要编写一个类来跟踪网页浏览的人数，肯定不希望每次实例化该类时都把访问者数量置0，只是就可以将该属性设置为<code>static</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Visitor</span><br><span class="line">&#123;</span><br><span class="line">    private static $visitors = 0;</span><br><span class="line"></span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        self::$visitors++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function getVisitors()</span><br><span class="line">    &#123;</span><br><span class="line">        return self::$visitors;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 实例化</span><br><span class="line">$visitor1 = new Visitor();</span><br><span class="line">echo Visitor::getVisitors() . &quot;\n&quot;;        // 1</span><br><span class="line"></span><br><span class="line">$visitor2 = new Visitor();</span><br><span class="line">echo Visitor::getVisitors() . &quot;\n&quot;;        // 2</span><br></pre></td></tr></table></figure>
<h1 id="延迟静态绑定"><a href="#延迟静态绑定" class="headerlink" title="延迟静态绑定"></a>延迟静态绑定</h1><p>PHP中的static关键字除了上述比较熟知的作用外，还可以作为延迟静态绑定使用，这是在5.3版本后才加入的功能。</p>
<p>先看如下的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">abstract class DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class User extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    public static function create()</span><br><span class="line">    &#123;</span><br><span class="line">        return new User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Document extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    public static function create()</span><br><span class="line">    &#123;</span><br><span class="line">        return new Document();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先创建了一个抽象类，然后创建了两个子类<code>User</code>和<code>Document</code>分别继承自<code>DomainObject</code>抽象类，这个代码运行起来完全没问题，而且能很好的工作，如果你是一位懒惰的程序猿，看到这样重复的代码你会很恼火，尤其是重复代码比较多的时候，就会想着如何重构它。每个<code>DomainObject</code>子类都有一个相同的<code>create()</code>函数，我们试着把它放入父类当中去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">abstract class DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    public static function create()</span><br><span class="line">    &#123;</span><br><span class="line">        return new self();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class User extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Document extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Document::create();</span><br></pre></td></tr></table></figure>
<p>很明显phpstorm会提示出错，我们试着运行会得到以下错误：</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/create%20with%20self%20in%20baseclass.png" alt=""></p>
<p>在上面的例子中，<code>self</code>对该类所起的作用与<code>$this</code>对对象所起的作用不完全相同，<code>self</code>被解析为定义<code>create()</code>的<code>DomainObject</code>，而不是解析为调用<code>self</code>的<code>Document</code>类。在PHP 5.3中延迟静态绑定的概念，最明显的标志就是使用<code>static</code>关键字，它指向的是被调用的类而不是包含类。上面的代码我们可以这么改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">abstract class DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    public static function create()</span><br><span class="line">    &#123;</span><br><span class="line">        return new static();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class User extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Document extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print_r(Document::create());</span><br></pre></td></tr></table></figure>
<p>输出：<br><img src="http://p8m3309kb.bkt.clouddn.com/delay%20static%20binding1.png" alt=""></p>
<p>static关键字不仅可以用于实例化，和<code>self</code>和<code>parent</code>一样，<code>static</code>还可以作为静态方法调用的标识符，甚至是从非静态上下文中调用。例如为<code>DomainObject</code>引入组的概念，默认组为<code>default</code>，可以用static为继承层次结构的某些子类重写组，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">abstract class DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    private $group;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;group = static::getGroup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function create()</span><br><span class="line">    &#123;</span><br><span class="line">        return new static();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function getGroup()</span><br><span class="line">    &#123;</span><br><span class="line">        return &quot;default&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class User extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Document extends DomainObject</span><br><span class="line">&#123;</span><br><span class="line">    public static function getGroup()</span><br><span class="line">    &#123;</span><br><span class="line">        return &quot;document&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SpreadSheet extends Document</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print_r(User::create());</span><br><span class="line">print_r(SpreadSheet::create());</span><br></pre></td></tr></table></figure>
<p>代码中，<code>DomainObject</code>的构造函数使用static调用静态方法<code>getGroup()</code>，设置默认组为<code>default</code>，在<code>Document</code>中重写了<code>getGroup()</code>方法，重新设置了组，下面是输出结果：</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/static%20group.png" alt=""></p>
<h2 id="PHP静态绑定的一个应用"><a href="#PHP静态绑定的一个应用" class="headerlink" title="PHP静态绑定的一个应用"></a>PHP静态绑定的一个应用</h2><blockquote>
<p>该例子来自简书：<a href="https://www.jianshu.com/p/25a78620fa5c" target="_blank" rel="noopener">https://www.jianshu.com/p/25a78620fa5c</a></p>
</blockquote>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>做的某项目有一个“转账”的功能，但是转账的类型有很多种，对应每种转账需要的参数也不同，举个例子一种转账是由系统转账给用户，那么就只有接收方和金额两个参数，另一种转账是用户之间的转账且支持留言，那么就有发送方接收方金额和留言四个参数。当然最简单的思路就是采用四个参数，对于第一种转账将不用的两个参数留空，这种方法的问题在于，考虑到未来可能增加的新的转账类型，可能会引入新的参数，那么代码很可能需要推倒重来，有没有更优雅的解决方式呢？</p>
<h3 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><p>其实Laravel里就有实现类似需求的例子，那就是查询构造器(Query Builder)，它的一个使用的例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$users = DB::table(&apos;users&apos;)</span><br><span class="line">                     -&gt;select(DB::raw(&apos;count(*) as user_count, status&apos;))</span><br><span class="line">                     -&gt;where(&apos;status&apos;, &apos;&lt;&gt;&apos;, 1)</span><br><span class="line">                     -&gt;groupBy(&apos;status&apos;)</span><br><span class="line">                     -&gt;get();</span><br></pre></td></tr></table></figure>
<p>这个方法和我们的需求就很像了，对于查询这一功能，传入哪些参数是未知的，例如某次具体的查询，可能需要调用groupBy也可能调用orderBy，也可能两者需要同时调用或者都不调用。一个思路就是针对每一个参数都写一个方法，需要时则调用，不需要时则不调用。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>整体的解决思路是写两个类，一个叫Transfer，一个叫Builder，每个参数对应的方法写在Builder里，由Transfer去调用Builder构造我们需要的转账类型，完成相关操作。这样当需求更新时（要增加新的参数时），只要在Builder里添加相应的方法即可，而不用改动现有代码。下面先贴一下对应的代码再做详细解释。<br>Transfer类代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Transfer</span><br><span class="line">&#123;</span><br><span class="line">    public function __call($method, $parameters)</span><br><span class="line">    &#123;</span><br><span class="line">        $builder = new Builder();</span><br><span class="line">        return call_user_func_array([$builder, $method], $parameters);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function __callStatic($method, $parameters)</span><br><span class="line">    &#123;</span><br><span class="line">        $instance = new static;</span><br><span class="line">        return call_user_func_array([$instance, $method], $parameters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Builder类实际上只涉及到具体的功能实现，就贴部分代码意思意思看看就行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Builder</span><br><span class="line">&#123;</span><br><span class="line">    protected $from = 0; // 0 represents system</span><br><span class="line">    protected $to = 0;</span><br><span class="line">    protected $amount = 0;</span><br><span class="line">    protected $comments = &apos;&apos;;</span><br><span class="line">    protected $related = [];</span><br><span class="line"></span><br><span class="line">    public function from($user)</span><br><span class="line">    &#123;</span><br><span class="line">        if ($user instanceof User) &#123;</span><br><span class="line">            $this-&gt;from = $user-&gt;getAuthIdentifier();</span><br><span class="line">        &#125; elseif (is_int($user)) &#123;</span><br><span class="line">            $this-&gt;from = $user;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            throw new InvalidArgumentException(sprintf(&apos;%s excepts $user parameter to be \App\User or integer, %s given.&apos;, __METHOD__, gettype($user)));</span><br><span class="line">        &#125;</span><br><span class="line">        return $this;</span><br><span class="line">    &#125;</span><br><span class="line">    public function to($user)&#123;...&#125;</span><br><span class="line">    public function amount(int $amount)&#123;...&#125;</span><br><span class="line">    public function comments($comments)&#123;...&#125;</span><br><span class="line">    public function related(int $type, int $id, $extra = null)&#123;...&#125;</span><br><span class="line">    public function transfer()&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体调用Transfer功能的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Transfer::from($sender)-&gt;to($receiver)-&gt;amount($amount)-&gt;comments($comments)-&gt;related($related_type, $related_id, $related_extra)-&gt;transfer();</span><br></pre></td></tr></table></figure>
<p>下面我们来走一遍调用Transfer的流程来看看。首先调用了<code>Transfer</code>类中的静态方法<code>from</code>，然而<code>Transfer</code>中并不存在这个静态方法，则会自动调用<code>__callStatic()</code>这个魔术方法。这个方法首先实例化了一个<code>static</code>对象。注意这里的static是一个类名，new出来的<code>$instance</code>是属于<code>static</code>这个类的一个实例化对象，有点拗口然后返回时调用了<code>call_user_func_array</code>这个方法，这个方法具体可以参考php的手册，实际上它完成了类似<code>$instance-&gt;method($parameters)</code>这样的操作，放到我们当前的情境下实际执行了<code>$transfer_instance-&gt;from($user)</code>这样的操作。</p>
<p>然后发觉<code>Transfer</code>中并不存在这个动态方法，于是又会自动调用<code>__call()</code>这个魔术方法。这个方法首先创建了一个<code>Builder</code>类的实例，之后调用<code>call_user_func_array</code>这个方法，实际上相当于执行了<code>$builder-&gt;from($user)</code>方法，然后终于得<code>Builder</code>类里找到了这个<code>from()</code>方法，注意它的返回值是$this。</p>
<p>然后当前这个<code>Builder</code>这个对象继续调用<code>to</code>方法，发觉又不存在又去调用<code>__call()</code>这个魔术方法，之后的过程同上，反复调用<code>Builder</code>中的方法把所有需要的参数都处理过以后最后调用了<code>transfer()</code>方法最终完成转账操作。</p>
<p>参考：</p>
<p><a href="http://www.php.net/manual/zh/language.oop5.static.php" target="_blank" rel="noopener">http://www.php.net/manual/zh/language.oop5.static.php</a><br><a href="https://www.jianshu.com/p/25a78620fa5c" target="_blank" rel="noopener">https://www.jianshu.com/p/25a78620fa5c</a></p>
<p>欢迎关注我的公众号：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2650331-0a591295c0869965.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xydida.com/2018/6/5/PHP/The-secret-you-do-not-know-the-static-in-PHP/" data-id="cjpwpr32f002m5m9ke2cqkt47" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-What-is-PSR" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/6/3/PHP/What-is-PSR/" class="article-date">
  <time datetime="2018-06-03T10:11:40.000Z" itemprop="datePublished">2018-06-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/6/3/PHP/What-is-PSR/">什么是PSR规范？</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1frz2da2mp9j318g0tnk5w.jpg" alt=""></p>
<h1 id="什么是PSR？"><a href="#什么是PSR？" class="headerlink" title="什么是PSR？"></a>什么是PSR？</h1><p>PSR是PHP Standards Recommendation的简称，这个是<a href="https://github.com/php-fig" target="_blank" rel="noopener">php-fig</a>组织制定的一套<a href="https://github.com/php-fig/fig-standards" target="_blank" rel="noopener">规范</a>。至今，php-fig已经发布了五个规范：</p>
<ul>
<li><a href="https://www.php-fig.org/psr/psr-0/" target="_blank" rel="noopener">PSR-0</a>：自动加载标准，2014-10-21该标准已经被废弃，使用PSR-4替代，不再细讲</li>
<li><a href="https://www.php-fig.org/psr/psr-1/" target="_blank" rel="noopener">PSR-1</a>：基本的编码风格</li>
<li><a href="https://www.php-fig.org/psr/psr-2/" target="_blank" rel="noopener">PSR-2</a>：编码风格（更严格）</li>
<li><a href="https://www.php-fig.org/psr/psr-3/" target="_blank" rel="noopener">PSR-3</a>：日志记录器接口</li>
<li><a href="https://www.php-fig.org/psr/psr-4/" target="_blank" rel="noopener">PSR-4</a>：自动加载</li>
</ul>
<h2 id="PSR-1"><a href="#PSR-1" class="headerlink" title="PSR-1"></a>PSR-1</h2><p>PHP标签：<br>PHP代码<strong>必须</strong>放在<code>&lt;?php ?&gt;</code>标签或<code>&lt;?= ?&gt;</code>标签中。</p>
<p>编码：<br>PHP文件<strong>必须</strong>使用无<a href="https://en.wikipedia.org/wiki/Byte_order_mark" target="_blank" rel="noopener">BOM</a>的<a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a>编码。</p>
<p>副作用：<br>一个PHP文件可以定义符号（比如类、函数、常量等），或者执行只有唯一副作用的操作（比如输出结果、处理数据等），但是不能同时做这两件事，尽量是一个PHP文件的功能单一。在操作的时候尽量把变量、类、函数的声明分开，通过<code>include</code>或<code>require</code>文件的方式来使用。</p>
<p>如下不符合规范：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 改变设置</span><br><span class="line">ini_set(&apos;error_reporting&apos;, E_ALL);</span><br><span class="line"></span><br><span class="line">// 加载文件</span><br><span class="line">include &quot;file.php&quot;;</span><br><span class="line"></span><br><span class="line">// 打印输出</span><br><span class="line">echo &quot;&lt;html&gt;\n&quot;;</span><br><span class="line"></span><br><span class="line">// 声明</span><br><span class="line">function foo()</span><br><span class="line">&#123;</span><br><span class="line">    // function body</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>符合规范如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 声明</span><br><span class="line">function foo()</span><br><span class="line">&#123;</span><br><span class="line">    // function body</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 条件判断</span><br><span class="line">if (! function_exists(&apos;bar&apos;)) &#123;</span><br><span class="line">    function bar()</span><br><span class="line">    &#123;</span><br><span class="line">        // function body</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>命名空间和类：<br>命名空间和类<strong>必须</strong>遵循PSR-4自动加载器标准。</p>
<p>类的名称：<br>每个类都有自己的命名空间，且都在顶级命名空间下，类名<strong>必须</strong>使用驼峰式（<a href="https://en.wikipedia.org/wiki/Camel_case" target="_blank" rel="noopener">CamelCase</a>）。<br>PHP 5.3 及以上，<strong>必须</strong>使用正式的命名空间，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// PHP 5.3 及以后</span><br><span class="line">namespace Vendor\Model;</span><br><span class="line"></span><br><span class="line">class Foo</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PHP 5.3一下<strong>应该</strong>使用<code>Vendor_</code>开头的伪命名空间约定，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// PHP 5.3以下</span><br><span class="line">class Vendor_Model_Foo</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>常量：<br>常量<strong>必须</strong>全部是用大写，并且使用下划线（_）分开。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Model;</span><br><span class="line"></span><br><span class="line">class Foo</span><br><span class="line">&#123;</span><br><span class="line">    const VERSION = &apos;1.0&apos;;</span><br><span class="line">    const DATE_APPROVED = &apos;2012-06-01&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类的方法：<br>类的方法<strong>必须</strong>使用小写字母开头的驼峰式（camelCase）命名。</p>
<h2 id="PSR-2"><a href="#PSR-2" class="headerlink" title="PSR-2"></a>PSR-2</h2><p>PSR-2是对PSR-1的PHP的扩充。</p>
<p>贯彻PSR-1：<br>使用PSR-2代码标准之前要先贯彻PSR-1的代码标准。</p>
<p>文件和代码行：<br>PHP文件<strong>必须</strong>使用Unix风格的换行符（LF， linefeed），最后要有一个空行，仅包含PHP代码的文件而且<strong>不能使用</strong>PHP关闭标签<code>?&gt;</code>，每行代码<strong>不应该</strong>超过80个字符，每行末尾不能有空格，每行只能有一条语句，可以在适当的地方添加空行提高代码的阅读性。</p>
<blockquote>
<p>不加上<code>?&gt;</code>关闭标签，可以避免意料之外的输出错误，如果加上关闭标签，且在关闭标签后有空行，那么空行会被当成输出，导致意想不到的错误。</p>
</blockquote>
<p>缩进：<br><strong>必须</strong>以4个空格为缩进，<strong>不能</strong>使用制表符（Tab键）缩进。</p>
<blockquote>
<p>在不同的编辑器中，空格的渲染效果基本一致，而制表符的宽度各有差异。</p>
</blockquote>
<p>关键字：<br>PHP的关键字<strong>必须</strong>使用小写，而且<code>true</code>, <code>false</code>, 和 <code>null</code>也<strong>必须</strong>小写。</p>
<p>命名空间和<code>use</code>声明：<br>现在，<code>namespace</code>声明之后<strong>必须</strong>要有一个空行，而且<code>use</code>声明<strong>必须</strong>放在<code>namespace</code>之后，<strong>必须</strong>分别使用<code>use</code>引入命名空间，而且<code>use</code>后要有空行，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">use FooClass;</span><br><span class="line">use BarClass as Bar;</span><br><span class="line">use OtherVendor\OtherPackage\BazClass;</span><br><span class="line"></span><br><span class="line">// ... additional PHP code ...</span><br></pre></td></tr></table></figure>
<p>类的继承和实现：<br><code>extends</code>和<code>implements</code>关键字<strong>必须</strong>和类名在同一行，类、接口和<code>Traits</code>定义体的起始括号应该在类名之后新起一行，结束括号也必须新起一行，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">use FooClass;</span><br><span class="line">use BarClass as Bar;</span><br><span class="line">use OtherVendor\OtherPackage\BazClass;</span><br><span class="line"></span><br><span class="line">class ClassName extends ParentClass implements \ArrayAccess, \Countable</span><br><span class="line">&#123;</span><br><span class="line">    // constants, properties, methods</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果<code>implements</code>后面后很多类导致一行很长，可以依次将需要的类另起新行并缩进4个空格，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">use FooClass;</span><br><span class="line">use BarClass as Bar;</span><br><span class="line">use OtherVendor\OtherPackage\BazClass;</span><br><span class="line"></span><br><span class="line">class ClassName extends ParentClass implements</span><br><span class="line">    \ArrayAccess,</span><br><span class="line">    \Countable,</span><br><span class="line">    \Serializable</span><br><span class="line">&#123;</span><br><span class="line">    // constants, properties, methods</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见性：<br>类中的每个属性和方法都要声明可见性，有<code>public</code>、<code>private</code>和<code>protected</code>，不能使用<code>var</code>关键词来声明，老版本的PHP会在私有属性前加上<code>_</code>，一行<strong>只能</strong>声明一个属性，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">class ClassName</span><br><span class="line">&#123;</span><br><span class="line">    public $foo = null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法：<br>类中的所有方法也应该定义可见性，方法名后面<strong>不能</strong>有空格，方法体的括号位置和类定义体的括号位置一样，都要新起一行，结束括号也要新起一行。方法参数的起始圆括号之后没有空格，结束括号之前也没有空格，有多个参数是，每个参数的逗号后面加一个空格，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">class ClassName</span><br><span class="line">&#123;</span><br><span class="line">    public function fooBarBaz($arg1, &amp;$arg2, $arg3 = [])</span><br><span class="line">    &#123;</span><br><span class="line">        // method body</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果参数比较多，需要换行时，可以如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">class ClassName</span><br><span class="line">&#123;</span><br><span class="line">    public function aVeryLongMethodName(</span><br><span class="line">        ClassTypeHint $arg1,</span><br><span class="line">        &amp;$arg2,</span><br><span class="line">        array $arg3 = []</span><br><span class="line">    ) &#123;</span><br><span class="line">        // method body</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>abstract</code>、<code>final</code>和<code>static</code>：<br>现在，<code>abstract</code>、<code>final</code><strong>必须</strong>在可见性修饰符之前，<code>static</code>声明<strong>必须</strong>放在可见性修饰符之后，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Vendor\Package;</span><br><span class="line"></span><br><span class="line">abstract class ClassName</span><br><span class="line">&#123;</span><br><span class="line">    protected static $foo;</span><br><span class="line"></span><br><span class="line">    abstract protected function zim();</span><br><span class="line"></span><br><span class="line">    final public static function bar()</span><br><span class="line">    &#123;</span><br><span class="line">        // method body</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法和函数的调用：<br>在调用方法和函数时，圆括号<strong>必须</strong>跟在函数名之后，函数的参数之间有一个空格：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">bar();</span><br><span class="line">$foo-&gt;bar($arg1);</span><br><span class="line">Foo::bar($arg2, $arg3);</span><br></pre></td></tr></table></figure>
<p>如果参数比较多，一行放不下时，如下处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$foo-&gt;bar(</span><br><span class="line">    $longArgument,</span><br><span class="line">    $longerArgument,</span><br><span class="line">    $muchLongerArgument</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>PHP的控制结构：<br>PHP的控制结构包括if、else、elseif、switch、case、while、do while、for、foreach、try和catch。如果这些关键词后面有一对原括号，开始括号前<strong>必须</strong>有一个空格，与方法和类的定义体不同，控制结构关键词后面的起始括号应该和控制结构关键词写在同一行，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$gorilla = new \Animals\Gorilla;</span><br><span class="line">$ibis = new \Animals\StrawNeckedIbis;</span><br><span class="line"></span><br><span class="line">if ($gorilla-&gt;isWake() === true) &#123;</span><br><span class="line">    do &#123;</span><br><span class="line">        $gorilla-&gt;beatChest();</span><br><span class="line">    &#125; while ($ibis-&gt;isAsleep() === true);</span><br><span class="line">    </span><br><span class="line">    $ibis-&gt;flyAway();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PHP闭包函数：<br>闭包函数在声明时，<code>function</code>关键词后<strong>必须</strong>有一个空格，同时<code>use</code>关键词前后也<strong>必须</strong>有一个空格。起始大括号不需要另起新行，详细的如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$closureWithArgs = function ($arg1, $arg2) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$closureWithArgsAndVars = function ($arg1, $arg2) use ($var1, $var2) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>闭包函数有多个参数时，处理方式和方法的参数一样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$longArgs_noVars = function (</span><br><span class="line">    $longArgument,</span><br><span class="line">    $longerArgument,</span><br><span class="line">    $muchLongerArgument</span><br><span class="line">) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$noArgs_longVars = function () use (</span><br><span class="line">    $longVar1,</span><br><span class="line">    $longerVar2,</span><br><span class="line">    $muchLongerVar3</span><br><span class="line">) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$longArgs_longVars = function (</span><br><span class="line">    $longArgument,</span><br><span class="line">    $longerArgument,</span><br><span class="line">    $muchLongerArgument</span><br><span class="line">) use (</span><br><span class="line">    $longVar1,</span><br><span class="line">    $longerVar2,</span><br><span class="line">    $muchLongerVar3</span><br><span class="line">) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$longArgs_shortVars = function (</span><br><span class="line">    $longArgument,</span><br><span class="line">    $longerArgument,</span><br><span class="line">    $muchLongerArgument</span><br><span class="line">) use ($var1) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$shortArgs_longVars = function ($arg) use (</span><br><span class="line">    $longVar1,</span><br><span class="line">    $longerVar2,</span><br><span class="line">    $muchLongerVar3</span><br><span class="line">) &#123;</span><br><span class="line">    // body</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：以上规则同样适用于将闭包作为函数或方法的参数，如下：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$foo-&gt;bar(</span><br><span class="line">    $arg1,</span><br><span class="line">    function ($arg2) use ($var1) &#123;</span><br><span class="line">        // body</span><br><span class="line">    &#125;,</span><br><span class="line">    $arg3</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="PSR-3"><a href="#PSR-3" class="headerlink" title="PSR-3"></a>PSR-3</h2><p>与PSR-1和PSR-2不同，PSR-3规定了一套通用的日志记录器接口（<code>Psr\Log\LoggerInterface</code>），为了符合PSR-3规范，框架必须实现该规范中的接口，这样可以更多的兼容第三方应用。PSR-3规范中包含了9个方法，每个方法都对应了<a href="https://tools.ietf.org/html/rfc5424" target="_blank" rel="noopener">RFC 5424</a>协议的一个日志级别，而且都接受两个参数<code>$message</code>和<code>$context</code>，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace Psr\Log;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Describes a logger instance</span><br><span class="line"> *</span><br><span class="line"> * The message MUST be a string or object implementing __toString().</span><br><span class="line"> *</span><br><span class="line"> * The message MAY contain placeholders in the form: &#123;foo&#125; where foo</span><br><span class="line"> * will be replaced by the context data in key &quot;foo&quot;.</span><br><span class="line"> *</span><br><span class="line"> * The context array can contain arbitrary data, the only assumption that</span><br><span class="line"> * can be made by implementors is that if an Exception instance is given</span><br><span class="line"> * to produce a stack trace, it MUST be in a key named &quot;exception&quot;.</span><br><span class="line"> *</span><br><span class="line"> * See https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-3-logger-interface.md</span><br><span class="line"> * for the full interface specification.</span><br><span class="line"> */</span><br><span class="line">interface LoggerInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * System is unusable.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function emergency($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Action must be taken immediately.</span><br><span class="line">     *</span><br><span class="line">     * Example: Entire website down, database unavailable, etc. This should</span><br><span class="line">     * trigger the SMS alerts and wake you up.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function alert($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Critical conditions.</span><br><span class="line">     *</span><br><span class="line">     * Example: Application component unavailable, unexpected exception.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function critical($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Runtime errors that do not require immediate action but should typically</span><br><span class="line">     * be logged and monitored.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function error($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Exceptional occurrences that are not errors.</span><br><span class="line">     *</span><br><span class="line">     * Example: Use of deprecated APIs, poor use of an API, undesirable things</span><br><span class="line">     * that are not necessarily wrong.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function warning($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Normal but significant events.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function notice($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Interesting events.</span><br><span class="line">     *</span><br><span class="line">     * Example: User logs in, SQL logs.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function info($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Detailed debug information.</span><br><span class="line">     *</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function debug($message, array $context = array());</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Logs with an arbitrary level.</span><br><span class="line">     *</span><br><span class="line">     * @param mixed $level</span><br><span class="line">     * @param string $message</span><br><span class="line">     * @param array $context</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function log($level, $message, array $context = array());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于message参数：</p>
<p><code>$message</code><strong>必须</strong>是一个字符串或者是含有<code>__toString()</code>方法的对象，<code>$message</code>应该包含占位符，例如<code>{placeholder_name}</code>，占位符由<code>{</code>、占位符名称和<code>}</code>组成，不能包含空格，占位符名称可以由<code>A-Z, a-z, 0-9, _</code>组成，第三方实现可以用<code>$context</code>参数来替换占位符，占位符名称<strong>必须</strong>和<code>$context</code>数组的key对应。如下例子是使用<code>$context</code>中的值替换<code>$message</code>中的占位符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Interpolates context values into the message placeholders.</span><br><span class="line"> */</span><br><span class="line">function interpolate($message, array $context = array())</span><br><span class="line">&#123;</span><br><span class="line">    // build a replacement array with braces around the context keys</span><br><span class="line">    $replace = array();</span><br><span class="line">    foreach ($context as $key =&gt; $val) &#123;</span><br><span class="line">        // check that the value can be casted to string</span><br><span class="line">        if (!is_array($val) &amp;&amp; (!is_object($val) || method_exists($val, &apos;__toString&apos;))) &#123;</span><br><span class="line">            $replace[&apos;&#123;&apos; . $key . &apos;&#125;&apos;] = $val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // interpolate replacement values into the message and return</span><br><span class="line">    return strtr($message, $replace);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// a message with brace-delimited placeholder names</span><br><span class="line">$message = &quot;User &#123;username&#125; created&quot;;</span><br><span class="line"></span><br><span class="line">// a context array of placeholder names =&gt; replacement values</span><br><span class="line">$context = array(&apos;username&apos; =&gt; &apos;bolivar&apos;);</span><br><span class="line"></span><br><span class="line">// echoes &quot;User bolivar created&quot;</span><br><span class="line">echo interpolate($message, $context);</span><br></pre></td></tr></table></figure>
<p>关于context参数：</p>
<p><code>$context</code>是一个数组参数，用于构造复杂的日志消息，<code>$context</code>中的值不能跑出任何PHP异常或错误。如果<code>$context</code>中包含<code>Exception</code>对象，则该对象的<code>key</code><strong>必须</strong>为<code>exception</code>。</p>
<h3 id="PSR-3日志记录器的使用"><a href="#PSR-3日志记录器的使用" class="headerlink" title="PSR-3日志记录器的使用"></a>PSR-3日志记录器的使用</h3><p>推荐使用<a href="https://packagist.org/packages/monolog/monolog" target="_blank" rel="noopener">monolog/monolog</a>，这样可以让我们不需要浪费更多的时间在编写一个日志记录器了。Monolog组建完全实现了PSR-3接口，而且便于使用自定义的消息格式化程序和处理程序扩展功能，通过Monolog可以把日志消息写入文本文件、系统日志和数据库中，还能通过电子邮件发送，并且还支持Slack和远程服务器。如下展示了如何设置Monolog，并把日志消息写入文本文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use Monolog/Logger;</span><br><span class="line">use Monolog/Handler/StreamHandler;</span><br><span class="line"></span><br><span class="line">// 创建日志记录器</span><br><span class="line">$log = new Logger(&apos;myApp&apos;);</span><br><span class="line">$log-&gt;pushHandler(new StreamHandler(&apos;logs/development.log, Logger::DEBUG));</span><br><span class="line">$log-&gt;pushHandler(new StreamHandler(&apos;logs/production.log&apos;, Logger::WARNING));</span><br><span class="line"></span><br><span class="line">// 使用日志记录器</span><br><span class="line">$log-&gt;debug(&quot;This is a debug message&quot;);</span><br><span class="line">$log-&gt;warning(&quot;This is a warning message&quot;);</span><br></pre></td></tr></table></figure>
<h2 id="PSR-4"><a href="#PSR-4" class="headerlink" title="PSR-4"></a>PSR-4</h2><p>PSR-4规范描述了一个标准的自动加载器策略，指在运行时按需查找PHP类、接口或<code>Traits</code>。支持PSR-4自动加载器标准的PHP组建和框架，使用同一个自动加载器就能找到相关代码，然后将其载入PHP解释器。有了这个功能，就可以把现代PHP生态系统中很多客户操作的组件联系起来。</p>
<h2 id="编写一个PSR-4自动加载器"><a href="#编写一个PSR-4自动加载器" class="headerlink" title="编写一个PSR-4自动加载器"></a>编写一个PSR-4自动加载器</h2><p>PSR-4规范不要求改变代码的实现方式，只建议如何使用文件系统目录结构和PHP命名空间组织代码，PSR-4规范以来PHP命名空间和文件系统目录结构查找并加载PHP类、接口和<code>Traits</code>，这正是PSR-4的精髓所在。下面我们来自己手动实现一个PSR-4自动加载器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * 使用SPL组册这个自动加载函数后，遇到下述代码时这个函数会尝试   从/path/to/project/src/Baz/Qux.php文件中加载\Foo\Bar\Baz\Qux类：</span><br><span class="line"> * 	new \Foo\Bar\Baz\Qux;</span><br><span class="line"> * @param string $class 完全限定的类名。</span><br><span class="line"> * @return void</span><br><span class="line"> * /</span><br><span class="line">spl_autoload_register(function ($class) &#123;</span><br><span class="line">    // 项目的命名空间前缀</span><br><span class="line">    $prefix = &apos;Foo\\Bar\\&apos;;</span><br><span class="line">    </span><br><span class="line">    // 目录前缀对应的根目录</span><br><span class="line">    $base_dir = __DIR__ . &apos;/src/&apos;;</span><br><span class="line">    </span><br><span class="line">    // 判断传入的类是否使用了这个命名空间前缀</span><br><span class="line">    $len = strlen($prefix);</span><br><span class="line">    if (strncmp($prefix, $class, $len) !== 0) &#123;</span><br><span class="line">        // 没有使用，交给注册的下一个自动加载器处理</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 获取去掉前缀后的类名</span><br><span class="line">    $relative_class = substr($class, $len);</span><br><span class="line">    </span><br><span class="line">    // 把命名空间前缀替换成根目录，</span><br><span class="line">    // 在去掉前缀的类名中，把命名空间分隔符替换成目录分隔符，</span><br><span class="line">    // 然后在后面加上.php</span><br><span class="line">    $file = $base_dir . str_replace(&apos;\\&apos;, &apos;/&apos;, $relative_class) . &apos;.php&apos;;</span><br><span class="line">    </span><br><span class="line">    // 如果该文件存在，就将其导入</span><br><span class="line">    if (file_exists($file)) &#123;</span><br><span class="line">        require $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样我们就写好了一个PSR-4的自动加载器了，更多关于PHP的自动加载机器可以看我<a href="https://xydida.com/2018/5/31/PHP/the-autoload-of-php/">这篇文章</a>。</p>
<p>参考：</p>
<ol>
<li>《Morden PHP中文版》</li>
<li><a href="https://www.php-fig.org" target="_blank" rel="noopener">https://www.php-fig.org</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xydida.com/2018/6/3/PHP/What-is-PSR/" data-id="cjpwpr32v00335m9k17j25lw9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PSR/">PSR</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Devops/">Devops</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Networks/">Networks</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Object-Oriented/">Object Oriented</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Regular-Expression/">Regular Expression</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/">frontend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/notes/">notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/小程序/">小程序</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/">Go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Object-Oriented/">Object Oriented</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Objective-C/">Objective-C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PSR/">PSR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perl/">Perl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ruby/">Ruby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SICP/">SICP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/">Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Something/">Something</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tmux/">Tmux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VB-NET/">VB.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autoload/">autoload</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interviews/">interviews</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/networks/">networks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/routing/">routing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 10px;">C#</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Go/" style="font-size: 10px;">Go</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Object-Oriented/" style="font-size: 10px;">Object Oriented</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/PSR/" style="font-size: 10px;">PSR</a> <a href="/tags/Perl/" style="font-size: 10px;">Perl</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/SICP/" style="font-size: 10px;">SICP</a> <a href="/tags/Server/" style="font-size: 15px;">Server</a> <a href="/tags/Something/" style="font-size: 10px;">Something</a> <a href="/tags/Swift/" style="font-size: 10px;">Swift</a> <a href="/tags/Tmux/" style="font-size: 10px;">Tmux</a> <a href="/tags/VB-NET/" style="font-size: 10px;">VB.NET</a> <a href="/tags/autoload/" style="font-size: 10px;">autoload</a> <a href="/tags/canvas/" style="font-size: 10px;">canvas</a> <a href="/tags/interviews/" style="font-size: 10px;">interviews</a> <a href="/tags/networks/" style="font-size: 10px;">networks</a> <a href="/tags/routing/" style="font-size: 10px;">routing</a> <a href="/tags/小程序/" style="font-size: 15px;">小程序</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/12/20/PHP/Clone-Object-in-PHP/">PHP中的对象复制</a>
          </li>
        
          <li>
            <a href="/2018/12/16/Linux/my-Tmux-notes/">我的Tmux笔记</a>
          </li>
        
          <li>
            <a href="/2018/12/15/PHP/Valet-problem-Unable-to-determine-linked-PHP/">Valet problem: Unable to determine linked PHP</a>
          </li>
        
          <li>
            <a href="/2018/9/14/小程序/The-measureText-function-in-Wechat-miniprogram-canvas/">在小程序Canvas中使用measureText</a>
          </li>
        
          <li>
            <a href="/2018/8/15/小程序/WeChat-miniprogram-data-analysis-custom-analysis/">微信小程序数据分析之自定义分析</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Bilberry<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>