<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>PHP的自动加载机制 | Hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The secret of PHP&apos;s autoload">
<meta name="keywords" content="PHP,autoload">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP的自动加载机制">
<meta property="og:url" content="http://xydida.com/2018/5/31/PHP/the-autoload-of-php/index.html">
<meta property="og:site_name" content="Hello">
<meta property="og:description" content="The secret of PHP&apos;s autoload">
<meta property="og:locale" content="zh">
<meta property="og:image" content="http://p8m3309kb.bkt.clouddn.com/__autoload%20example1.png">
<meta property="og:image" content="http://p8m3309kb.bkt.clouddn.com/spl_autoload%20example1.png">
<meta property="og:image" content="http://p8m3309kb.bkt.clouddn.com/spl_autoload_register%20example1.png">
<meta property="og:image" content="http://p8m3309kb.bkt.clouddn.com/spl_autoload_register%20example2.png">
<meta property="og:image" content="http://p8m3309kb.bkt.clouddn.com/getLoader%20function.png">
<meta property="og:image" content="http://p8m3309kb.bkt.clouddn.com/load%20undefined%20class%20foo.png">
<meta property="og:updated_time" content="2018-05-31T09:24:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP的自动加载机制">
<meta name="twitter:description" content="The secret of PHP&apos;s autoload">
<meta name="twitter:image" content="http://p8m3309kb.bkt.clouddn.com/__autoload%20example1.png">
  
    <link rel="alternate" href="/atom.xml" title="Hello" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">能找到我的也不是等闲之辈</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xydida.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-the-autoload-of-php" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/5/31/PHP/the-autoload-of-php/" class="article-date">
  <time datetime="2018-05-31T02:10:15.000Z" itemprop="datePublished">2018-05-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PHP的自动加载机制
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是自动加载？"><a href="#什么是自动加载？" class="headerlink" title="什么是自动加载？"></a>什么是自动加载？</h1><p>​    顾名思义，就是当我们在使用一个东西的时候，如果这个东西还不存在，于是我们所处的环境就自动帮我们把需要的那个东西拿过来供我们使用，通俗地讲就是这个意思。</p>
<h1 id="PHP中的自动加载"><a href="#PHP中的自动加载" class="headerlink" title="PHP中的自动加载"></a>PHP中的自动加载</h1><p>​    我们在开始接触PHP时，会先写一个PHP文件，当项目比较大了，就会写好多PHP文件，在不同的PHP文件中，如果要用到其他PHP文件中的内容，比如实例化其他文件中的类，就会使用到<code>require</code>、<code>include</code>等函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Foo.php</div><div class="line">class Foo&#123;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Bar.php</div><div class="line">require &apos;Foo.php&apos;;</div><div class="line"></div><div class="line">$foo = new Foo;</div></pre></td></tr></table></figure>
<p>​    这种方法看起来很好，确实在一些古老的PHP项目中确实是这样做的，比如ECShop，但一旦这个项目变大，并且还使用了面向对象技术，各种各样的类文件多到很难管理时，<code>require</code>、<code>include</code>等技术还方便吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// index.php</div><div class="line">require &apos;A.class.php&apos;;</div><div class="line">require &apos;B.class.php&apos;;</div><div class="line">require &apos;C.class.php&apos;;</div><div class="line">require &apos;D.class.php&apos;;</div><div class="line">require &apos;E.class.php&apos;;</div><div class="line">...</div><div class="line">require &apos;Z.class.php&apos;;</div><div class="line"></div><div class="line">$a = new A;</div><div class="line">$b = new B;</div><div class="line">...</div><div class="line">...</div></pre></td></tr></table></figure>
<p>​    这么多的<code>require</code>，你不会在一个现代PHP框架中见到。那么，在现代PHP中是怎么解决这种问题的呢？</p>
<p>​    在PHP 5以后，PHP拥有了完善的面向对象部分，PHP中使用了autoload技术来解决在一个文件中include多个PHP脚本。</p>
<h2 id="相关技术"><a href="#相关技术" class="headerlink" title="相关技术"></a>相关技术</h2><ul>
<li><a href="http://php.net/manual/en/function.autoload.php" target="_blank" rel="external">__autoload</a></li>
<li><a href="http://php.net/manual/en/function.spl-autoload.php" target="_blank" rel="external">spl_autoload</a></li>
<li><a href="http://php.net/manual/en/function.spl-autoload-register.php" target="_blank" rel="external">spl_autoload_register</a></li>
</ul>
<h3 id="autoload"><a href="#autoload" class="headerlink" title="_autoload"></a>_autoload</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* 用于加载未定义的类</div><div class="line">* @param $class 需要加载的类名</div><div class="line">*/</div><div class="line">void __auto(string $class)</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：此方法已经在PHP 7.2中标记为<em>DEPRECATED</em>，不建议继续使用</p>
</blockquote>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">//myClass.php</div><div class="line">&lt;?php</div><div class="line">class myClass &#123;</div><div class="line">    public function __construct() &#123;</div><div class="line">        echo &quot;myClass init&apos;ed successfuly!!!&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">?&gt;</div><div class="line"></div><div class="line">// index.php</div><div class="line">&lt;?php</div><div class="line">function __autoload($classname) &#123;</div><div class="line">    $filename = &quot;./&quot;. $classname .&quot;.php&quot;;</div><div class="line">    include_once($filename);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$obj = new myClass();	// 输出：myClass init&apos;ed successfuly!!!</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p><img src="http://p8m3309kb.bkt.clouddn.com/__autoload%20example1.png" alt=""></p>
<p>​    在<code>index.php</code>中我们并没有指明把<code>myClass.php</code>加载进来，但是依然可以实例化<code>myClass</code>对象。</p>
<h3 id="spl-autoload"><a href="#spl-autoload" class="headerlink" title="spl_autoload"></a>spl_autoload</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* __autoload()的默认实现</div><div class="line">* @param $class_name 需要被实例化的小写类名或命名空间</div><div class="line">* @param $file_extensions 文件扩展名，默认为.inc或.php</div><div class="line">*/</div><div class="line">void spl_autoload ( string $class_name [, string $file_extensions = spl_autoload_extensions() ] )</div></pre></td></tr></table></figure>
<p>​    该函数是<code>__autoload()</code>函数的默认实现，如果在调用<code>spl_autoload_register()</code>函数时没有设置任何参数，那么此函数将作为默认加载函数被注册，意思是说如果使用<code>spl_autoload_register()</code>来自动加载时，如果没有指定特殊的加载器，那么将通过<code>spl_autoload()</code>来加载。</p>
<p>​    通常使用该函数时，还需要一些其他的函数配合使用，比如<code>set_include_path()</code>、<code>spl_autoload_extensions()</code>等。</p>
<h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// class/Foo.class.php</div><div class="line">class Foo</div><div class="line">&#123;</div><div class="line">	public function __construct() &#123;</div><div class="line">        echo &quot;Foo init successfully!!!&quot;;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// index.php</div><div class="line">set_include_path(&apos;class/&apos;);</div><div class="line">spl_autoload_extensions(&apos;.class.php&apos;);</div><div class="line">spl_autoload(&apos;Foo&apos;);</div><div class="line"></div><div class="line">$foo = new Foo;</div></pre></td></tr></table></figure>
<p><img src="http://p8m3309kb.bkt.clouddn.com/spl_autoload%20example1.png" alt=""></p>
<p>​    可以看到，在<code>spl_autoload()</code>中不能对传过来的<code>class_name</code>做一些判断或修改，需要配合其他函数来设置，此时如果想要在自动加载时做一些判断修改，只能使用<code>__autoload()</code>或者下面的<code>spl_autoload_register()</code>。</p>
<h3 id="spl-autoload-register"><a href="#spl-autoload-register" class="headerlink" title="spl_autoload_register"></a>spl_autoload_register</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* 注册一个自动加载器，这个注册的加载器可以替换__autoload()</div><div class="line">* @param $autoload_function 需要被注册的自动加载函数，如果没有指定，会将spl_autoload()函数注册</div><div class="line">* @param $throw 是否允许函数抛出异常，默认为true</div><div class="line">* @param $prepend 是否将这个函数加载器放在队列的最前面，默认为false</div><div class="line">* @return bool</div><div class="line">*/</div><div class="line">bool spl_autoload_register([ callable $autoload_function [, bool $throw = TRUE [, bool $prepend = FALSE ]]])</div></pre></td></tr></table></figure>
<p>​    此函数可以可以注册一个带有<code>spl __autoload</code>队列的函数，并且将会启用这个队列。</p>
<h4 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// class/Foo.class.php</div><div class="line">class Foo</div><div class="line">&#123;</div><div class="line">	public function __construct() &#123;</div><div class="line">        echo &quot;Foo init successfully by spl_autoload_register!!!&quot;;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// index.php</div><div class="line">// 自定义一个加载器，再加载器中可以对参数$class 做一些判断</div><div class="line">function my_autoloader($class) &#123;</div><div class="line">    include &apos;classes/&apos; . $class . &apos;.class.php&apos;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">spl_autoload_register(&apos;my_autoloader&apos;);</div><div class="line">// 或者使用一个匿名函数作为加载器</div><div class="line">spl_autoload_register(function ($class) &#123;</div><div class="line">    include &apos;class/&apos; . $class . &apos;.class.php&apos;;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$foo = new Foo;</div></pre></td></tr></table></figure>
<p><img src="http://p8m3309kb.bkt.clouddn.com/spl_autoload_register%20example1.png" alt=""></p>
<p>通过命令空间来注册：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// index.php</div><div class="line">namespace Foobar;</div><div class="line"></div><div class="line">class Foo &#123;</div><div class="line">    static public function test($class) &#123;</div><div class="line">        echo $class . &quot; autoloaded by namespace&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">spl_autoload_register(__NAMESPACE__ .&apos;\Foo::test&apos;);</div><div class="line"></div><div class="line">new AClass;</div></pre></td></tr></table></figure>
<p><img src="http://p8m3309kb.bkt.clouddn.com/spl_autoload_register%20example2.png" alt=""></p>
<p>​    学了这么多，我们知道了什么是自动加载技术。再来回到文章开头，那个不存在的东西就是我们将要实例化的类，我们所处的环境就是PHP这个环境，自动把没有的东西拿过来给我们用就是使用以上技术加载所需要的类文件，以供我们实例化所需。</p>
<h2 id="Laravel中的自动加载"><a href="#Laravel中的自动加载" class="headerlink" title="Laravel中的自动加载"></a>Laravel中的自动加载</h2><h4 id="从Nginx的配置文件说起"><a href="#从Nginx的配置文件说起" class="headerlink" title="从Nginx的配置文件说起"></a>从Nginx的配置文件说起</h4><p>官方建议的Nginx服务配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name example.com;</div><div class="line">    root /example.com/public;</div><div class="line"></div><div class="line">    add_header X-Frame-Options &quot;SAMEORIGIN&quot;;   </div><div class="line">    add_header X-XSS-Protection &quot;1; mode=block&quot;; </div><div class="line">    add_header X-Content-Type-Options &quot;nosniff&quot;; </div><div class="line"></div><div class="line">    index index.html index.htm index.php;</div><div class="line"></div><div class="line">    charset utf-8;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ /index.php?$query_string;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location = /favicon.ico &#123; access_log off; log_not_found off; &#125;  </div><div class="line">    location = /robots.txt  &#123; access_log off; log_not_found off; &#125;  </div><div class="line"></div><div class="line">    error_page 404 /index.php;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</div><div class="line">        fastcgi_pass unix:/var/run/php/php7.1-fpm.sock;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        include fastcgi_params;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ /\.(?!well-known).* &#123;</div><div class="line">        deny all;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>关于该配置为详细说明，就不在此说了，有兴趣的可以查看这篇文章：<a href="https://segmentfault.com/a/1190000011404105" target="_blank" rel="external">Laravel 5.5 官方推荐 Nginx 配置学习</a> 。从配置文件中发现Laravel项目的入口文件是<code>public/index.php</code>，于是，就从该文件开始分析。</p>
<p>public/index.php文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">|--------------------------------------------------------------------------</div><div class="line">| Register The Auto Loader</div><div class="line">|--------------------------------------------------------------------------</div><div class="line">|</div><div class="line">| Composer provides a convenient, automatically generated class loader for</div><div class="line">| our application. We just need to utilize it! We&apos;ll simply require it</div><div class="line">| into the script here so that we don&apos;t have to worry about manual</div><div class="line">| loading any of our classes later on. It feels nice to relax.</div><div class="line">|</div><div class="line">*/</div><div class="line"></div><div class="line">require __DIR__.&apos;/../bootstrap/autoload.php&apos;;</div></pre></td></tr></table></figure>
<p>可以看到，在入口文件中引入了<code>bootstrap/autoload.php</code>这个文件，根据文件名可以大致猜出和自动加载有点关系，而且看注释，就是使用了<code>Composer</code>的自动加载，因为Laravel本身会从<code>vendor</code>目录引用很多第三方库，继续看<code>bootstrap/autoload.php</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">|--------------------------------------------------------------------------</div><div class="line">| Register The Composer Auto Loader</div><div class="line">|--------------------------------------------------------------------------</div><div class="line">|</div><div class="line">| Composer provides a convenient, automatically generated class loader</div><div class="line">| for our application. We just need to utilize it! We&apos;ll require it</div><div class="line">| into the script here so that we do not have to worry about the</div><div class="line">| loading of any our classes &quot;manually&quot;. Feels great to relax.</div><div class="line">|</div><div class="line">*/</div><div class="line"></div><div class="line">require __DIR__.&apos;/../vendor/autoload.php&apos;;</div></pre></td></tr></table></figure>
<p>在<code>bootstrap/autoload.php</code>文件中引入了<code>vendor/autoload.php</code>，<code>vendor/</code>里面保存的是第三方库，继续查看<code>vendor/autoload.php</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"></div><div class="line">// autoload.php @generated by Composer</div><div class="line"></div><div class="line">require_once __DIR__ . &apos;/composer/autoload_real.php&apos;;</div><div class="line"></div><div class="line">return ComposerAutoloaderInit9794f3f3ddfd00f32b75ea45e287b507::getLoader();</div></pre></td></tr></table></figure>
<p>只有两行代码，一个是引入<code>vendor/composer/autoload_real.php</code>，最后调用<code>ComposerAutoloaderInit9794f3f3ddfd00f32b75ea45e287b507::getLoader()</code>返回，看到这里知道既然从这里返回，那么<code>getLoader()</code>方法里面肯定做了一些自动加载的事情。查看该方法。</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/getLoader%20function.png" alt=""></p>
<p>这是一个静态方法，首先检查静态属性loader是否被实例化，如果已经实例化了则直接返回，否则继续执行下面的代码，很明显这是一个单例模式，Laravel项目中每次只保留一个loader。接下来就用到了<code>spl_autoload_register()</code>函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 注册loadClassLoader加载器</div><div class="line">spl_autoload_register(array(&apos;ComposerAutoloaderInit9794f3f3ddfd00f32b75ea45e287b507&apos;, &apos;loadClassLoader&apos;), true, true);</div><div class="line">// 创建一个loadClassLoader实例</div><div class="line">self::$loader = $loader = new \Composer\Autoload\ClassLoader();</div></pre></td></tr></table></figure>
<p>可以看到，先是注册了一个函数名叫<code>loadClassLoader</code>的加载器，再通过这个加载器开始类的加载。看一下这个加载器的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public static function loadClassLoader($class)</div><div class="line">&#123;</div><div class="line">    if (&apos;Composer\Autoload\ClassLoader&apos; === $class) &#123;</div><div class="line">        require __DIR__ . &apos;/ClassLoader.php&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很简单，就是判断要加载的不是<code>Composer\Autoload\ClassLoader</code>这个类，如果是就引入该类，否则什么也不做，这就是自动加载。</p>
<p>我们来检验一下，分析的是否正确，修改<code>loadClassLoader()</code>函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public static function loadClassLoader($class)</div><div class="line">&#123;</div><div class="line">	// 引入Foo这个类</div><div class="line">    if (&apos;Foo&apos; === $class) &#123;</div><div class="line">        echo &apos;Foo from loadClassLoader&apos;;</div><div class="line">        exit();</div><div class="line">    &#125;</div><div class="line">    if (&apos;Composer\Autoload\ClassLoader&apos; === $class) &#123;</div><div class="line">         require __DIR__ . &apos;/ClassLoader.php&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<code>getLoader()</code>中添加一段代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static function getLoader()</div><div class="line">&#123;</div><div class="line">    // 单例模式</div><div class="line">    if (null !== self::$loader) &#123;</div><div class="line">        return self::$loader;</div><div class="line">    &#125;</div><div class="line">    // 注册loadClassLoader加载器</div><div class="line">    spl_autoload_register(array(&apos;ComposerAutoloaderInit9794f3f3ddfd00f32b75ea45e287b507&apos;, &apos;loadClassLoader&apos;), true, true);</div><div class="line">    // 创建一个loadClassLoader实例</div><div class="line">    self::$loader = $loader = new \Composer\Autoload\ClassLoader();</div><div class="line">    // 创建为定义的类的实例</div><div class="line">    $foo = new Foo;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<p><img src="http://p8m3309kb.bkt.clouddn.com/load%20undefined%20class%20foo.png" alt=""></p>
<p>运行结果和我们猜想的一样。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>​    学习了PHP自动加载技术，发现其实一点也不神奇，主要就是依靠<code>spl_autoload_register()</code>和<code>spl_autoload()</code>函数，底层还是使用了<code>include</code>的方式，所谓的自动，只是不需要我们每次都在PHP文件的顶部写很多<code>include</code>命令，只要把使用了自动加载函数的文件引入进来，当执行到未定义的类时，就会自动引入相关的类文件。为达到效果，其实也完全可以用一个循环来引入所需要的类，只是在循环引用前，需要把类名和类所在的文件做一个映射，但这样做完全没有使用自动加载函数来的优雅，而且还不灵活，还没有使用到命名空间。</p>
<p>参考：<a href="http://php.net/manual/en/language.oop5.autoload.php" target="_blank" rel="external">http://php.net/manual/en/language.oop5.autoload.php</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xydida.com/2018/5/31/PHP/the-autoload-of-php/" data-id="cjhuc3sn50006t4seiidky6ie" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/autoload/">autoload</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/5/15/Linux/Use-screen-to-manage-your-remote-session/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">使用Screen管理远程回话</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Devops/">Devops</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Networks/">Networks</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/frontend/">frontend</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/notes/">notes</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SICP/">SICP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/">Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Something/">Something</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autoload/">autoload</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interviews/">interviews</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/networks/">networks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/routing/">routing</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/SICP/" style="font-size: 10px;">SICP</a> <a href="/tags/Server/" style="font-size: 20px;">Server</a> <a href="/tags/Something/" style="font-size: 10px;">Something</a> <a href="/tags/autoload/" style="font-size: 10px;">autoload</a> <a href="/tags/interviews/" style="font-size: 10px;">interviews</a> <a href="/tags/networks/" style="font-size: 10px;">networks</a> <a href="/tags/routing/" style="font-size: 10px;">routing</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/5/31/PHP/the-autoload-of-php/">PHP的自动加载机制</a>
          </li>
        
          <li>
            <a href="/2018/5/15/Linux/Use-screen-to-manage-your-remote-session/">使用Screen管理远程回话</a>
          </li>
        
          <li>
            <a href="/2018/5/14/Networks/Routing-Selection/">IP中的路由选择</a>
          </li>
        
          <li>
            <a href="/2018/2/4/Devops/Base-configuration-for-a-new-server/">对一台新服务器的简单的配置</a>
          </li>
        
          <li>
            <a href="/2017/12/19/Algorithm/sieve-stream/">用厄拉多塞法筛选素数</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Bilberry<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>